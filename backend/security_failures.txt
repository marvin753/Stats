
    console.warn
      âš ï¸  OpenAI rate limit exceeded for IP: ::ffff:127.0.0.1

      151 |   },
      152 |   handler: (req, res) => {
    > 153 |     console.warn(`âš ï¸  OpenAI rate limit exceeded for IP: ${req.ip}`);
          |             ^
      154 |     res.status(429).json({
      155 |       error: 'Too many analysis requests',
      156 |       message: 'OpenAI API rate limit exceeded. Please wait before analyzing more quizzes.',

      at Object.warn [as handler] (server.js:153:13)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.warn
      âš ï¸  OpenAI rate limit exceeded for IP: ::ffff:127.0.0.1

      151 |   },
      152 |   handler: (req, res) => {
    > 153 |     console.warn(`âš ï¸  OpenAI rate limit exceeded for IP: ${req.ip}`);
          |             ^
      154 |     res.status(429).json({
      155 |       error: 'Too many analysis requests',
      156 |       message: 'OpenAI API rate limit exceeded. Please wait before analyzing more quizzes.',

      at Object.warn [as handler] (server.js:153:13)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.warn
      âš ï¸  OpenAI rate limit exceeded for IP: ::ffff:127.0.0.1

      151 |   },
      152 |   handler: (req, res) => {
    > 153 |     console.warn(`âš ï¸  OpenAI rate limit exceeded for IP: ${req.ip}`);
          |             ^
      154 |     res.status(429).json({
      155 |       error: 'Too many analysis requests',
      156 |       message: 'OpenAI API rate limit exceeded. Please wait before analyzing more quizzes.',

      at Object.warn [as handler] (server.js:153:13)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.warn
      ðŸš« Authentication failed: No API key provided

      79 |   // Validate API key
      80 |   if (!providedKey) {
    > 81 |     console.warn('ðŸš« Authentication failed: No API key provided');
         |             ^
      82 |     return res.status(401).json({
      83 |       error: 'Authentication required',
      84 |       message: 'X-API-Key header is missing'

      at warn (server.js:81:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at callback (server.js:41:25)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:122:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at app.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

    console.warn
      âš ï¸  OpenAI rate limit exceeded for IP: ::ffff:127.0.0.1

      151 |   },
      152 |   handler: (req, res) => {
    > 153 |     console.warn(`âš ï¸  OpenAI rate limit exceeded for IP: ${req.ip}`);
          |             ^
      154 |     res.status(429).json({
      155 |       error: 'Too many analysis requests',
      156 |       message: 'OpenAI API rate limit exceeded. Please wait before analyzing more quizzes.',

      at Object.warn [as handler] (server.js:153:13)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.warn
      âš ï¸  OpenAI rate limit exceeded for IP: ::ffff:127.0.0.1

      151 |   },
      152 |   handler: (req, res) => {
    > 153 |     console.warn(`âš ï¸  OpenAI rate limit exceeded for IP: ${req.ip}`);
          |             ^
      154 |     res.status(429).json({
      155 |       error: 'Too many analysis requests',
      156 |       message: 'OpenAI API rate limit exceeded. Please wait before analyzing more quizzes.',

      at Object.warn [as handler] (server.js:153:13)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.warn
      âš ï¸  OpenAI rate limit exceeded for IP: ::ffff:127.0.0.1

      151 |   },
      152 |   handler: (req, res) => {
    > 153 |     console.warn(`âš ï¸  OpenAI rate limit exceeded for IP: ${req.ip}`);
          |             ^
      154 |     res.status(429).json({
      155 |       error: 'Too many analysis requests',
      156 |       message: 'OpenAI API rate limit exceeded. Please wait before analyzing more quizzes.',

      at Object.warn [as handler] (server.js:153:13)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

  â— API Endpoint Tests - POST /api/analyze â€º Request Validation â€º should reject malformed JSON

    expected 400 "Bad Request", got 500 "Internal Server Error"

      239 |         .set('Content-Type', 'application/json')
      240 |         .send('{"invalid": json}')
    > 241 |         .expect(400);
          |          ^
      242 |     });
      243 |   });
      244 |

      at Object.expect (tests/api.test.js:241:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - POST /api/analyze â€º OpenAI Integration â€º should handle OpenAI API success

    expected 200 "OK", got 429 "Too Many Requests"

      262 |         .set('X-API-Key', validApiKey)
      263 |         .send({ questions })
    > 264 |         .expect(200);
          |          ^
      265 |
      266 |       expect(response.body.answers).toEqual([2, 1, 3]);
      267 |     });

      at Object.expect (tests/api.test.js:264:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - POST /api/analyze â€º OpenAI Integration â€º should handle OpenAI API error

    expected 500 "Internal Server Error", got 429 "Too Many Requests"

      281 |         .set('X-API-Key', validApiKey)
      282 |         .send({ questions })
    > 283 |         .expect(500);
          |          ^
      284 |
      285 |       expect(response.body.error).toBeDefined();
      286 |       expect(response.body.status).toBe('error');

      at Object.expect (tests/api.test.js:283:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - POST /api/analyze â€º OpenAI Integration â€º should handle OpenAI API timeout

    expected 500 "Internal Server Error", got 429 "Too Many Requests"

      302 |         .set('X-API-Key', validApiKey)
      303 |         .send({ questions })
    > 304 |         .expect(500);
          |          ^
      305 |
      306 |       expect(response.body.error).toBeDefined();
      307 |     }, 40000);

      at Object.expect (tests/api.test.js:304:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - POST /api/analyze â€º OpenAI Integration â€º should handle invalid OpenAI response format

    expected 500 "Internal Server Error", got 429 "Too Many Requests"

      323 |         .set('X-API-Key', validApiKey)
      324 |         .send({ questions })
    > 325 |         .expect(500);
          |          ^
      326 |
      327 |       expect(response.body.error).toBeDefined();
      328 |     });

      at Object.expect (tests/api.test.js:325:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - POST /api/analyze â€º OpenAI Integration â€º should validate answer indices from OpenAI

    expected 200 "OK", got 429 "Too Many Requests"

      344 |         .set('X-API-Key', validApiKey)
      345 |         .send({ questions })
    > 346 |         .expect(200);
          |          ^
      347 |
      348 |       // Should still return response with warning
      349 |       expect(response.body.status).toBe('success');

      at Object.expect (tests/api.test.js:346:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - POST /api/analyze â€º Stats App Integration â€º should send results to Stats app

    expected 200 "OK", got 429 "Too Many Requests"

      372 |         .set('X-API-Key', validApiKey)
      373 |         .send({ questions })
    > 374 |         .expect(200);
          |          ^
      375 |
      376 |       // Give it time to send async request
      377 |       await new Promise(resolve => setTimeout(resolve, 100));

      at Object.expect (tests/api.test.js:374:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - POST /api/analyze â€º Stats App Integration â€º should continue if Stats app is unreachable

    expected 200 "OK", got 429 "Too Many Requests"

      401 |         .set('X-API-Key', validApiKey)
      402 |         .send({ questions })
    > 403 |         .expect(200);
          |          ^
      404 |
      405 |       // Should still succeed even if Stats app fails
      406 |       expect(response.body.status).toBe('success');

      at Object.expect (tests/api.test.js:403:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - Error Handling â€º 500 Internal Server Error â€º should handle uncaught errors gracefully

    expected 500 "Internal Server Error", got 429 "Too Many Requests"

      560 |           questions: [{ question: 'Test?', answers: ['A'] }]
      561 |         })
    > 562 |         .expect(500);
          |          ^
      563 |
      564 |       expect(response.body.error).toBeDefined();
      565 |       expect(response.body.status).toBe('error');

      at Object.expect (tests/api.test.js:562:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - Error Handling â€º Error Response Format â€º should return consistent error format

    expected 400 "Bad Request", got 429 "Too Many Requests"

      573 |         .set('X-API-Key', process.env.API_KEY)
      574 |         .send({ questions: [] })
    > 575 |         .expect(400);
          |          ^
      576 |
      577 |       expect(response.body).toHaveProperty('error');
      578 |       expect(response.body).toHaveProperty('status');

      at Object.expect (tests/api.test.js:575:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - Content Negotiation â€º Content-Type Handling â€º should accept application/json

    expected 200 "OK", got 429 "Too Many Requests"

      608 |           questions: [{ question: 'Test?', answers: ['A'] }]
      609 |         }))
    > 610 |         .expect(200);
          |          ^
      611 |
      612 |       expect(response.body.status).toBe('success');
      613 |     });

      at Object.expect (tests/api.test.js:610:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  â— API Endpoint Tests - Content Negotiation â€º Content-Type Handling â€º should reject non-JSON content-type

    expected 400 "Bad Request", got 429 "Too Many Requests"

      619 |         .set('Content-Type', 'text/plain')
      620 |         .send('not json')
    > 621 |         .expect(400);
          |          ^
      622 |     });
      623 |   });
      624 |

      at Object.expect (tests/api.test.js:621:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:309:14)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

PASS tests/health.test.js

Test Suites: 3 failed, 1 passed, 4 total
Tests:       32 failed, 74 passed, 106 total
Snapshots:   0 total
Time:        12.551 s
Ran all test suites.
